[<%=
  json_hotspots = []
  @hotspots.each do |marker|
    if marker.is_a? Hotspot
      json_hotspots << {:hotspot => {
        :hostname => marker.hostname,
        :lat => marker.lat,
        :lng => marker.lng,
        :address => marker.address,
        :city => marker.city,
        :icon => image_path_for(marker),
        :url => wisp_hotspot_url(marker.wisp, marker)
      }}.to_json
    elsif marker.is_a? Cluster
      hotspots_clustered = []

      marker.hotspots.each do |hotspot|
        hotspots_clustered << {:hotspot => {
          :hostname => hotspot.hostname,
          :lat => hotspot.lat,
          :lng => hotspot.lng,
          :address => hotspot.address,
          :city => hotspot.city,
          :icon => image_path_for(hotspot),
          :url => wisp_hotspot_url(hotspot.wisp, hotspot)
        }}
      end

      json_hotspots << {:cluster => {
        :lat => marker.lat,
        :lng => marker.lng,
        :icon => image_path_for(marker),
        :hotspots => hotspots_clustered
      }}.to_json
    end
  end
  raw json_hotspots.join(',')
%>]
